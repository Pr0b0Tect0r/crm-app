(this["webpackJsonpcrm-app"]=this["webpackJsonpcrm-app"]||[]).push([[21],{605:function(e,a,t){"use strict";t.r(a),t.d(a,"default",(function(){return ee}));var n=t(133),l=t(84),o=t(110),i=t(1),r=t.n(i),c=t(560),s=t(21),m=t(73),u=t(70),d=t(562),C=t(315),E=t(585),f=t(575),g=t(569),p=t(172),h=t(564),v=t(571),b=t(581),y=t(582),j=t(584),L=t(570),O=t(563),S=t(139),x=t.n(S),I=t(555),N=t(190),M=t(616),R=t(559),T=t(590),w=t(525),k=t(591),A=t(620),U=t(523),_=t.n(U),F=t(173),P=t.n(F),D=t(524),B=t.n(D),Y=t(573),V=t(574),H=t(580),z=t(557),G=t(520),q=t.n(G),J=t(521),W=t.n(J),K=t(522),Q=t.n(K),X=t(556),$=Object(C.a)((function(e){return{root:{width:"100%",marginTop:e.spacing(10)},close:{padding:e.spacing(.5)},appBar:{position:"fixed"},title:{marginLeft:e.spacing(2),flex:1},"@keyframes blinker":{"0%":{opacity:1},"50%":{opacity:.2},"100%":{opacity:1}},avatar:{height:50,width:50,animation:"$blinker 1s infinite"},linea:{width:"105%"},chatRight:{display:"flex",justifyContent:"flex-end"},me:{backgroundColor:e.palette.primary.main,margin:4,borderRadius:"10px 10px 0 10px",color:e.palette.getContrastText(e.palette.primary.main)},listame:{position:"flex",justifyContent:"flex-end"},them:{backgroundColor:e.palette.secondary.main,margin:4,borderRadius:"0 10px 10px 10px",color:e.palette.getContrastText(e.palette.secondary.main)},listathem:{position:"flex",justifyContent:"flex-start"},textoMensaje:Object(o.a)({},"& fieldset",{borderRadius:50}),listaGeneral:{top:e.spacing(7),width:"100%",position:"fixed",overflow:"auto",maxHeight:"80%"},grid:{position:"fixed",left:e.spacing(1),bottom:e.spacing(4),width:"100%"},grid2:{height:"80%"},message:{display:"flex",alignItems:"center"},avatarMensaje:{marginRight:e.spacing(1)},speedLlamadas:{position:"fixed",top:e.spacing(1.3),right:e.spacing(2)},div:{position:"absolute",width:"100%",height:"100%"},speedArchivos:{position:"fixed",top:e.spacing(1.3),right:e.spacing(8)},inputFile:{display:"none"},imagenMensaje:{padding:6,width:"100%",height:"100%"}}})),Z=r.a.forwardRef((function(e,a){return r.a.createElement(j.a,Object.assign({direction:"up",ref:a},e))}));function ee(){var e=r.a.useState([]),a=Object(l.a)(e,2),t=a[0],o=a[1],i=r.a.useState(!0),C=Object(l.a)(i,2),j=C[0],S=C[1],U=r.a.useState(null),F=Object(l.a)(U,2),D=F[0],G=F[1],J=r.a.useState(null),K=Object(l.a)(J,2),ee=K[0],ae=K[1],te=r.a.useState([]),ne=Object(l.a)(te,2),le=ne[0],oe=ne[1],ie=r.a.useState(!1),re=Object(l.a)(ie,2),ce=re[0],se=re[1],me=r.a.useState(!1),ue=Object(l.a)(me,2),de=ue[0],Ce=ue[1],Ee=r.a.useState(null),fe=Object(l.a)(Ee,2),ge=fe[0],pe=fe[1],he=r.a.useState(!1),ve=Object(l.a)(he,2),be=ve[0],ye=ve[1],je=r.a.useState(!1),Le=Object(l.a)(je,2),Oe=Le[0],Se=Le[1],xe=r.a.useState({}),Ie=Object(l.a)(xe,2),Ne=Ie[0],Me=Ie[1],Re=r.a.useState(!1),Te=Object(l.a)(Re,2),we=Te[0],ke=Te[1],Ae=r.a.useState(!1),Ue=Object(l.a)(Ae,2),_e=Ue[0],Fe=Ue[1],Pe=r.a.useState(!1),De=Object(l.a)(Pe,2),Be=De[0],Ye=De[1],Ve=r.a.useState(null),He=Object(l.a)(Ve,2),ze=He[0],Ge=He[1],qe=r.a.useState(!1),Je=Object(l.a)(qe,2),We=Je[0],Ke=Je[1],Qe=r.a.useState(null),Xe=Object(l.a)(Qe,2),$e=Xe[0],Ze=Xe[1],ea=r.a.useState(null),aa=Object(l.a)(ea,2),ta=aa[0],na=aa[1],la=r.a.useState(!1),oa=Object(l.a)(la,2),ia=oa[0],ra=oa[1],ca="UNIQUE_LISTENER_ID",sa=$(),ma=JSON.parse(localStorage.getItem("usuarioChat")),ua=function(){Ce(!1),G(null)},da=function(){var e=document.getElementById("lista");e.scrollHeight-e.scrollTop===e.clientHeight||(e.scrollTop=e.scrollHeight)},Ca=function(e){var a=new s.CometChat.MediaMessage(D,e.target.files[0],s.CometChat.MESSAGE_TYPE.FILE,s.CometChat.RECEIVER_TYPE.USER);s.CometChat.sendMediaMessage(a).then((function(e){oe([].concat(Object(n.a)(le),[e])),da()}),(function(e){console.log("No se pudo enviar el archivo: ",e)}))},Ea=function(e){if(e){var a=e.target.files;if(a){var t=a[0];if(t){if(["image/gif","image/jpeg","image/png","image/webp","image/svg+xml"].includes(t.type)&&!(t.size>20971520)){var l=new s.CometChat.MediaMessage(D,t,s.CometChat.MESSAGE_TYPE.IMAGE,s.CometChat.RECEIVER_TYPE.USER);s.CometChat.sendMediaMessage(l).then((function(e){oe([].concat(Object(n.a)(le),[e])),da()}),(function(e){console.log("No se pudo enviar el archivo: ",e)}))}}}}};return r.a.useEffect((function(){return(new s.CometChat.UsersRequestBuilder).setLimit(30).build().fetchNext().then((function(e){o(e),S(!1)}),(function(e){console.log("Error al recibir lista: ",e)})),function(){s.CometChat.removeMessageListener("listener-key")}}),[]),r.a.useEffect((function(){(s.CometChat.addCallListener(ca,new s.CometChat.CallListener({onIncomingCallReceived:function(e){var a=[e];na(a[0].callInitiator.avatar),Ke(!0),Ze(a[0].sessionId)},onOutgoingCallAccepted:function(e){var a=e.sessionID;s.CometChat.startCall(a,document.getElementById("callScreen"),new s.CometChat.OngoingCallListener({onUserJoined:function(){},onUserLeft:function(){ra(!1)},onCallEnded:function(){ra(!1)}}))},onOutgoingCallRejected:function(){Ye(!1)},onIncomingCallCancelled:function(){Ke(!1)}})),s.CometChat.addMessageListener(ca,new s.CometChat.MessageListener({onTextMessageReceived:function(e){Me({avatar:e.sender.avatar,texto:e.text,nombre:e.sender.uid}),ye(!0)},onMediaMessageReceived:function(){}})),s.CometChat.addUserListener(ca,new s.CometChat.UserListener({onUserOnline:function(e){Me({avatar:e.avatar,nombre:e.uid}),(new s.CometChat.UsersRequestBuilder).setLimit(30).build().fetchNext().then((function(e){o(e),S(!1)}),(function(e){console.log("Error al recibir lista: ",e)})),Se(!0)},onUserOffline:function(){(new s.CometChat.UsersRequestBuilder).setLimit(30).build().fetchNext().then((function(e){o(e),S(!1)}),(function(e){console.log("Error al recibir lista: ",e)}))}})),D)&&((new s.CometChat.MessagesRequestBuilder).setUID(D).setLimit(30).build().fetchPrevious().then((function(e){oe(e),se(!1),da()}),(function(e){console.log("Error la recibir mensajes:",e)})),s.CometChat.removeMessageListener("listener-key"),s.CometChat.addCallListener(ca,new s.CometChat.CallListener({onIncomingCallReceived:function(e){var a=[e];na(a[0].callInitiator.avatar),Ke(!0),Ze(a[0].sessionId)},onOutgoingCallAccepted:function(e){var a=e.sessionID;Ye(!1),ra(!0),s.CometChat.startCall(a,document.getElementById("callScreen"),new s.CometChat.OngoingCallListener({onUserJoined:function(){},onUserLeft:function(){ra(!1)},onCallEnded:function(){ra(!1)}}))},onOutgoingCallRejected:function(){Ye(!1)},onIncomingCallCancelled:function(){Ke(!1),Ye(!1)}})),s.CometChat.addMessageListener(ca,new s.CometChat.MessageListener({onTextMessageReceived:function(e){D===e.sender.uid&&(oe((function(a){return[].concat(Object(n.a)(a),[e])})),da())},onMediaMessageReceived:function(e){D===e.sender.uid&&oe((function(a){return[].concat(Object(n.a)(a),[e])}))}})))}),[D]),j?r.a.createElement(m.a,{position:"absolute",top:"50%",left:"50%"},r.a.createElement(u.a,{color:"primary"})):r.a.createElement(r.a.Fragment,null,r.a.createElement(c.a,null),r.a.createElement(w.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:be,TransitionComponent:Z,autoHideDuration:3e3,onClose:function(){return ye(!1)},style:{opacity:"0.9"},ContentProps:{"aria-describedby":"mensaje"},message:r.a.createElement(I.a,{variant:"button",className:sa.message},r.a.createElement(h.a,{src:Ne.avatar,alt:"...",className:sa.avatarMensaje}),Ne.texto),action:[r.a.createElement(O.a,{key:"close","aria-label":"close",color:"inherit",className:sa.close,onClick:function(){return ye(!1)}},r.a.createElement(x.a,null))]}),r.a.createElement(w.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:Oe,TransitionComponent:Z,autoHideDuration:3e3,onClose:function(){return Se(!1)},style:{opacity:"0.9"},ContentProps:{"aria-describedby":"mensaje"},message:r.a.createElement(I.a,{variant:"button",className:sa.message},r.a.createElement(h.a,{src:Ne.avatar,alt:"...",className:sa.avatarMensaje}),"".concat(Ne.nombre," se ha conectado")),action:[r.a.createElement(O.a,{key:"close","aria-label":"close",color:"inherit",className:sa.close,onClick:function(){return Se(!1)}},r.a.createElement(x.a,null))]}),r.a.createElement(L.a,{fullWidth:!0,open:Be,onClose:function(){return Ye(!1)},TransitionComponent:Z},r.a.createElement(Y.a,null,r.a.createElement(I.a,{variant:"button"},"Llamando...")),r.a.createElement(V.a,null,r.a.createElement(h.a,{src:ee,alt:"...",className:sa.avatar})),r.a.createElement(H.a,null,r.a.createElement(z.a,{color:"secondary",onClick:function(){return Ye(!1),void s.CometChat.rejectCall(ze,s.CometChat.CALL_STATUS.CANCELLED).then((function(){Ge(null)}),(function(e){console.log("Error al cancelar llamada: ",e)}))}},"Cancelar"))),r.a.createElement(L.a,{fullWidth:!0,open:We,onClose:function(){return Ke(!1)},TransitionComponent:Z},r.a.createElement(Y.a,null,r.a.createElement(I.a,{variant:"button"},"Llamanda entrante...")),r.a.createElement(V.a,null,r.a.createElement(h.a,{src:ta,alt:"...",className:sa.avatar})),r.a.createElement(H.a,null,r.a.createElement(z.a,{color:"secondary",onClick:function(){return Ke(!1),void s.CometChat.rejectCall($e,s.CometChat.CALL_STATUS.CANCELLED).then((function(){}),(function(e){console.log("Error al rechazar llamada: ",e)}))}},"Cancelar"),r.a.createElement(z.a,{color:"primary",variant:"contained",onClick:function(){return Ke(!1),void s.CometChat.acceptCall($e).then((function(){ra(!0),s.CometChat.startCall($e,document.getElementById("callScreen"),new s.CometChat.OngoingCallListener({onCallEnded:function(e){ra(!1)}}))}),(function(e){console.log("Error al aceptar la llamada: ",e)}))}},"Aceptar"))),r.a.createElement(L.a,{fullScreen:!0,open:ia,onClose:function(){return ra(!1)},TransitionComponent:Z},r.a.createElement("div",{id:"callScreen",className:sa.div})),r.a.createElement(L.a,{fullScreen:!0,open:de,onClose:ua,TransitionComponent:Z},r.a.createElement(b.a,{className:sa.appBar},r.a.createElement(y.a,null,r.a.createElement(O.a,{edge:"start",color:"inherit",onClick:ua,"aria-label":"cerrar"},r.a.createElement(x.a,null)),r.a.createElement(h.a,{src:ee}),r.a.createElement(I.a,{variant:"h6",className:sa.title},"".concat(D)),r.a.createElement(k.a,{className:sa.speedArchivos,direction:"down",FabProps:{size:"small",color:"secondary"},ariaLabel:"Archivos",icon:r.a.createElement(q.a,null),onClose:function(){return Fe(!1)},onOpen:function(){return Fe(!0)},open:_e},[{name:"File"},{name:"Images"}].map((function(e){return r.a.createElement(A.a,{key:e.name,icon:"File"===e.name?r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{className:sa.inputFile,name:"archivoFile",id:"archivoFile",type:"file",onChange:Ca}),r.a.createElement("label",{htmlFor:"archivoFile"},r.a.createElement(W.a,null))):"Images"===e.name?r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{className:sa.inputFile,accept:"image/*",name:"archivoImages",id:"archivoImages",type:"file",onChange:Ea}),r.a.createElement("label",{htmlFor:"archivoImages"},r.a.createElement(Q.a,null))):"",tooltipTitle:e.name})}))),r.a.createElement(k.a,{className:sa.speedLlamadas,direction:"down",FabProps:{size:"small",color:"secondary"},ariaLabel:"Llamadas",icon:r.a.createElement(_.a,null),onClose:function(){return ke(!1)},onOpen:function(){return ke(!0)},open:we},[{name:"Audio"},{name:"Video"}].map((function(e){return r.a.createElement(A.a,{key:e.name,icon:"Audio"===e.name?r.a.createElement(P.a,null):"Video"===e.name?r.a.createElement(B.a,null):"",tooltipTitle:e.name,onClick:"Audio"===e.name?function(){return function(){Ye(!0);var e=new s.CometChat.Call(D,s.CometChat.CALL_TYPE.AUDIO,s.CometChat.RECEIVER_TYPE.USER);s.CometChat.initiateCall(e).then((function(e){Ge([e][0].sessionId)}),(function(e){console.log("Ha fallado el inicio de llamada: ",e)}))}()}:"Video"===e.name?function(){return function(){Ye(!0);var e=new s.CometChat.Call(D,s.CometChat.CALL_TYPE.VIDEO,s.CometChat.RECEIVER_TYPE.USER);s.CometChat.initiateCall(e).then((function(e){Ge([e][0].sessionId)}),(function(e){console.log("Ha fallado el inicio de llamada: ",e)}))}()}:""})})))),ce?r.a.createElement(N.a,{color:"secondary",className:sa.linea}):null),r.a.createElement(R.a,{container:!0,spacing:2},r.a.createElement(R.a,{item:!0,xs:12},r.a.createElement(g.a,{className:sa.listaGeneral,id:"lista"},ce?null:le.map((function(e,a){return e.receiverId!==ma.uid?r.a.createElement(T.a,{in:!0,timeout:500,key:a},r.a.createElement(f.a,{key:a,className:sa.listame},r.a.createElement(d.a,{elevation:4,className:sa.me},"text"===e.type?r.a.createElement(I.a,{variant:"body1",style:{padding:6}},e.text):"audio"===e.type?r.a.createElement(I.a,{variant:"body1",style:{padding:6}},"".concat(e.sender.uid," te llam\xf3")):"video"===e.type?r.a.createElement(I.a,{variant:"body1",style:{padding:6}},"".concat(e.sender.uid," te llam\xf3")):"file"===e.type?r.a.createElement(X.a,{href:e.data.url,color:"inherit",target:"_blank"},r.a.createElement(I.a,{variant:"body1",style:{padding:6}},e.data.url)):"image"===e.type?r.a.createElement(X.a,{href:e.data.url,target:"_blank"},r.a.createElement("img",{src:e.data.url,className:sa.imagenMensaje,alt:"..."})):""),r.a.createElement(h.a,{src:ma.avatar,alt:"..."}))):r.a.createElement(T.a,{in:!0,timeout:500,key:a},r.a.createElement(f.a,{key:a,className:sa.listathem},r.a.createElement(h.a,{src:ee,alt:"..."}),r.a.createElement(d.a,{elevation:4,className:sa.them},"text"===e.type?r.a.createElement(I.a,{variant:"body1",style:{padding:6}},e.text):"audio"===e.type?r.a.createElement(I.a,{variant:"body1",style:{padding:6}},"".concat(e.sender.uid," te llam\xf3")):"video"===e.type?r.a.createElement(I.a,{variant:"body1",style:{padding:6}},"".concat(e.sender.uid," te llam\xf3")):"file"===e.type?r.a.createElement(X.a,{href:e.data.url,color:"inherit",target:"_blank"},r.a.createElement(I.a,{variant:"body1",style:{padding:6}},e.data.url)):"image"===e.type?r.a.createElement(X.a,{href:e.data.url,target:"_blank"},r.a.createElement("img",{src:e.data.url,className:sa.imagenMensaje,alt:"..."})):"")))}))))),r.a.createElement(R.a,{container:!0,spacing:2,className:sa.grid},r.a.createElement(R.a,{item:!0,xs:12,sm:12},r.a.createElement(M.a,{autoComplete:"mensaje",autoFocus:!0,className:sa.textoMensaje,placeholder:"Escribe un mensaje...",required:!0,fullWidth:!0,onKeyDown:function(e){13===e.keyCode&&(!function(){var e=new s.CometChat.TextMessage(D,ge,s.CometChat.RECEIVER_TYPE.USER,s.CometChat.MESSAGE_TYPE.TEXT);s.CometChat.sendMessage(e).then((function(e){oe([].concat(Object(n.a)(le),[e])),da()}),(function(e){console.log("No se pudo enviar el mensaje:",e)}))}(),document.activeElement.value="")},onChange:function(e){pe(e.target.value)},type:"text",variant:"outlined"})))),r.a.createElement(v.a,{in:!0,timeout:1e3},r.a.createElement(d.a,{elevation:4,className:sa.root},r.a.createElement(g.a,null,t.map((function(e,a){return r.a.createElement(f.a,{key:a,button:!0,divider:!0,onClick:function(){return a=e.uid,t=e.avatar,G(a),ae(t),se(!0),void Ce(!0);var a,t}},r.a.createElement(p.a,null,r.a.createElement(h.a,{src:e.avatar})),r.a.createElement(E.a,{primary:e.name,secondary:"".concat(e.uid," - ").concat(e.status)}))}))))))}}}]);
//# sourceMappingURL=21.5d77f1b7.chunk.js.map